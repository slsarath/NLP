from sentence_transformers import SentenceTransformer

# Load model
model = SentenceTransformer('all-MiniLM-L6-v2')

# Extract raw utterances from transcript column
raw_utterances = df['Transcript']

# Initialize list to store cleaned, valid utterances
utterances = []

for idx, line in raw_utterances.items():
    if pd.isna(line):  # Skip NaN
        continue
    try:
        text = str(line).strip()
        if not text:
            continue
        cleaned = clean_text(text)  # Your cleaning function
        if cleaned:
            utterances.append(cleaned)
    except Exception as e:
        print(f"Skipping line at index {idx} due to error: {e}")

# Final check before embedding
print(f"Total valid utterances to embed: {len(utterances)}")

# Generate embeddings
embeddings = model.encode(utterances, show_progress_bar=True)