import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.cluster import KMeans

# Sample DataFrame with refund narratives
# df = pd.DataFrame({'refunds_narrative': [...]})


# Step 1: Vectorize the text data using TF-IDF
vectorizer = TfidfVectorizer(stop_words='english', max_features=1000)  # Limit features to save memory
X = vectorizer.fit_transform(df['refunds_narrative'])

# Step 2: Apply KMeans clustering
num_clusters = 5  # Adjust the number of clusters as needed
kmeans = KMeans(n_clusters=num_clusters, random_state=42)
df['cluster'] = kmeans.fit_predict(X)

# Step 3: Label clusters in the DataFrame
df['cluster'] = df['cluster'].apply(lambda x: f'Cluster {x + 1}')

# Display clustered data
print(df[['refunds_narrative', 'cluster']])