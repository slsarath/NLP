import pandas as pd

# Sample Data
# Replace this with your actual file loading
big_df = pd.DataFrame({
    'narrative': ['Refund due to error', 'System issue caused refund', 'Another refund'],
    'other_col': [1, 2, 3]
})
unique_df = pd.DataFrame({
    'narrative': ['refund due to error', 'system issue caused refund'],
    'col1': [10, 20],
    'col2': [15, 25],
    'col3': [5, 10],
    'col4': [8, 18]
})

# Function to standardize narratives
def standardize_text(text):
    if pd.isnull(text):
        return None
    text = text.lower().strip()  # Lowercase and strip whitespace
    text = ' '.join(text.split())  # Remove extra spaces
    return text

# Apply standardization
big_df['standardized_narrative'] = big_df['narrative'].apply(standardize_text)
unique_df['standardized_narrative'] = unique_df['narrative'].apply(standardize_text)

# Merge the datasets on the standardized narrative
merged_df = big_df.merge(
    unique_df[['standardized_narrative', 'col1', 'col2', 'col3', 'col4']],
    on='standardized_narrative',
    how='left'
)

# Drop the standardized narrative column if not needed
merged_df = merged_df.drop(columns=['standardized_narrative'])

# Display final dataset
print(merged_df)