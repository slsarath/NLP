import pandas as pd
import re

# Function to clean text data
def clean_text(value):
    if isinstance(value, str):
        value = re.sub(r'[^\x20-\x7E]', '', value)  # Remove non-printable characters
        value = value.strip()  # Trim spaces
    return value

# Function to prevent Excel formula injection
def prevent_formula_injection(value):
    if isinstance(value, str) and value.startswith(("=", "+", "-")):
        return "'" + value  # Add a leading apostrophe to prevent formula execution
    return value

# Apply cleaning functions to the DataFrame
df = df.applymap(clean_text)  # Clean invalid characters
df = df.applymap(prevent_formula_injection)  # Prevent formula injection
df.columns = [col.replace("\n", " ").strip() for col in df.columns]  # Fix column names

# Save to Excel safely
df.to_excel("output.xlsx", index=False, encoding="utf-8")